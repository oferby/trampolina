//
// AWS Signature v4 Implementation for Web Browsers
//
// Copyright (c) 2016 Daniel Joos
//
// Distributed under MIT license. (See file LICENSE)
//
!function(e,t){"function"==typeof define&&define.amd?define(["crypto-js/core","crypto-js/sha256","crypto-js/hmac-sha256"],t):"object"==typeof module&&module.exports?module.exports=t(require("crypto-js/core"),require("crypto-js/sha256"),require("crypto-js/hmac-sha256")):e.awsSignWeb=t(CryptoJS,CryptoJS.SHA256,CryptoJS.HmacSHA256)}(this,function(e){"use strict";function t(e,t){var r={host:t.uri.host,"content-type":e.config.defaultContentType,accept:e.config.defaultAcceptType,"x-amz-date":s(t.signDate)};t.request.method=t.request.method.toUpperCase(),t.request.body?t.payload=t.request.body:t.request.data&&e.payloadSerializer?t.payload=e.payloadSerializer(t.request.data):delete r["content-type"],t.request.headers=p(r,Object.keys(t.request.headers||{}).reduce(function(e,r){return e[r.toLowerCase()]=t.request.headers[r],e},{})),t.sortedHeaderKeys=Object.keys(t.request.headers).sort(),t.request.headers["content-type"]&&(t.request.headers["content-type"]=t.request.headers["content-type"].split(";")[0]),"object"==typeof t.request.params&&p(t.uri.queryParams,t.request.params)}function r(e,t){t.signedHeaders=t.sortedHeaderKeys.map(function(e){return e.toLowerCase()}).join(";"),t.canonicalRequest=String(t.request.method).toUpperCase()+"\n"+encodeURI(t.uri.path)+"\n"+Object.keys(t.uri.queryParams).sort().map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t.uri.queryParams[e])}).join("&")+"\n"+t.sortedHeaderKeys.map(function(e){return e.toLocaleLowerCase()+":"+t.request.headers[e]}).join("\n")+"\n\n"+t.signedHeaders+"\n"+e.hasher.hash(t.payload?t.payload:"")}function n(e,t){t.credentialScope=[s(t.signDate,!0),e.config.region,e.config.service,"aws4_request"].join("/"),t.stringToSign="AWS4-HMAC-SHA256\n"+s(t.signDate)+"\n"+t.credentialScope+"\n"+e.hasher.hash(t.canonicalRequest)}function a(e,t){var r=e.hasher.hmac,n=r(r(r(r("AWS4"+e.config.secretAccessKey,s(t.signDate,!0),{hexOutput:!1}),e.config.region,{hexOutput:!1,textInput:!1}),e.config.service,{hexOutput:!1,textInput:!1}),"aws4_request",{hexOutput:!1,textInput:!1});t.signature=r(n,t.stringToSign,{textInput:!1})}function o(e,t){t.authorization="AWS4-HMAC-SHA256 Credential="+e.config.accessKeyId+"/"+t.credentialScope+", SignedHeaders="+t.signedHeaders+", Signature="+t.signature}function s(e,t){var r=e.toISOString().replace(/[:\-]|\.\d{3}/g,"").substr(0,17);return t?r.substr(0,8):r}function i(){return function(e){return JSON.stringify(e)}}function c(){function e(e){return/^\??(.*)$/.exec(e)[1].split("&").reduce(function(e,t){return t=/^(.+)=(.*)$/.exec(t),t&&(e[t[1]]=t[2]),e},{})}var t=document?document.createElement("a"):{};return function(r){return t.href=r,{protocol:t.protocol,host:t.host.replace(/^(.*):((80)|(443))$/,"$1"),path:("/"!==t.pathname.charAt(0)?"/":"")+t.pathname,queryParams:e(t.search)}}}function u(){return{hash:function(t,r){r=p({hexOutput:!0,textInput:!0},r);var n=e.SHA256(t);return r.hexOutput?n.toString(e.enc.Hex):n},hmac:function(t,r,n){n=p({hexOutput:!0,textInput:!0},n);var a=e.HmacSHA256(r,t,{asBytes:!0});return n.hexOutput?a.toString(e.enc.Hex):a}}}function p(e){var t=[].slice.call(arguments,1);return t.forEach(function(t){t&&"object"==typeof t&&Object.keys(t).forEach(function(r){var n=t[r];"undefined"!=typeof n&&(null!==n&&"object"==typeof n?(e[r]=Array.isArray(n)?[]:{},p(e[r],n)):e[r]=n)})}),e}function h(e,t){if("undefined"==typeof e||!e)throw new Error(t)}var d={region:"eu-west-1",service:"execute-api",defaultContentType:"application/json",defaultAcceptType:"application/json",payloadSerializerFactory:i,uriParserFactory:c,hasherFactory:u},y=function(e){this.config=p({},d,e),this.payloadSerializer=this.config.payloadSerializer||this.config.payloadSerializerFactory(),this.uriParser=this.config.uriParserFactory(),this.hasher=this.config.hasherFactory(),h(this.config.accessKeyId,"AwsSigner requires AWS AccessKeyID"),h(this.config.secretAccessKey,"AwsSigner requires AWS SecretAccessKey")};return y.prototype.sign=function(e,s){var i={request:p({},e),signDate:s||new Date,uri:this.uriParser(e.url)};return t(this,i),r(this,i),n(this,i),a(this,i),o(this,i),{Accept:i.request.headers.accept,Authorization:i.authorization,"Content-Type":i.request.headers["content-type"],"x-amz-date":i.request.headers["x-amz-date"],"x-amz-security-token":this.config.sessionToken||void 0}},{AwsSigner:y}});